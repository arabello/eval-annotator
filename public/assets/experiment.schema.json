{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Experiment",
  "description": "Schema for evaluation experiments",
  "type": "object",
  "required": ["name", "entries"],
  "properties": {
    "name": {
      "type": "string",
      "description": "The name of the experiment"
    },
    "entries": {
      "type": "array",
      "description": "List of experiment entries to evaluate",
      "items": {
        "$ref": "#/definitions/ExperimentEntry"
      }
    }
  },
  "definitions": {
    "ToolCall": {
      "type": "object",
      "required": ["name", "arguments"],
      "properties": {
        "name": {
          "type": "string",
          "description": "The name of the tool/function being called"
        },
        "arguments": {
          "type": "object",
          "description": "The arguments passed to the tool call",
          "additionalProperties": true
        }
      }
    },
    "Message": {
      "type": "object",
      "required": ["role", "content"],
      "properties": {
        "role": {
          "type": "string",
          "enum": ["user", "assistant"],
          "description": "The role of the message sender"
        },
        "content": {
          "type": "string",
          "description": "The content of the message"
        }
      }
    },
    "ExperimentEntry": {
      "type": "object",
      "required": ["id", "messages", "baseline_answer", "candidate_answer"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the entry"
        },
        "messages": {
          "type": "array",
          "description": "List of messages in the conversation (excluding the last assistant message which is stored in baseline_answer)",
          "items": {
            "$ref": "#/definitions/Message"
          }
        },
        "baseline_answer": {
          "type": "string",
          "description": "The last assistant message content from the baseline conversation"
        },
        "candidate_answer": {
          "type": "string",
          "description": "The candidate answer to evaluate"
        },
        "expected_tool_calls": {
          "type": "array",
          "description": "Expected tool calls that should be made",
          "items": {
            "$ref": "#/definitions/ToolCall"
          }
        },
        "actual_tool_calls": {
          "type": "array",
          "description": "Actual tool calls that were made",
          "items": {
            "$ref": "#/definitions/ToolCall"
          }
        },
        "notes": {
          "type": "string",
          "description": "Optional notes about this entry"
        },
        "annotation": {
          "type": "string",
          "enum": ["pass", "fail"],
          "description": "Optional evaluation annotation for this entry"
        },
        "context": {
          "type": "object",
          "description": "Optional contextual information used in the software to generate the candidate answer",
          "additionalProperties": true
        }
      }
    }
  }
}
